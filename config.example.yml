# SemperVigil configuration
# Copy to config.yml (or mount as /config/config.yml in docker)
# Sources live in the DB; sources.example.yml is documentation only.

app:
  name: SemperVigil
  timezone: America/New_York

paths:
  data_dir: /data
  output_dir: /site/content/posts
  state_db: /data/state.sqlite3
  run_reports_dir: /data/reports

publishing:
  format: hugo_markdown
  hugo_section: posts
  write_json_index: true
  json_index_path: /site/static/sempervigil/index.json

ingest:
  http:
    timeout_seconds: 20
    user_agent: "SemperVigil/0.1 (+https://github.com/jasondaemon/SemperVigil)"
    max_retries: 2
    backoff_seconds: 2
  dedupe:
    enabled: true
    # stable id is typically derived from canonical url
    strategy: canonical_url_hash
  filters:
    # applied after parsing; optional
    allow_keywords: []
    deny_keywords: []
  scheduling:
    # used by cron / orchestrator later; not required for manual runs
    default_run_interval_minutes: 60

jobs:
  # reclaim jobs if a worker crashes without releasing a lock
  lock_timeout_seconds: 600

cve:
  enabled: true
  sync_interval_minutes: 60
  results_per_page: 2000
  rate_limit_seconds: 1.0
  backoff_seconds: 2.0
  max_retries: 3
  prefer_v4: true

llm:
  enabled: false
  provider: openai
  # API key must come from env var OPENAI_API_KEY
  openai:
    model: gpt-4o-mini
    temperature: 0.2
    max_tokens: 400
  tasks:
    summarize: true
    tag: true

per_source_tweaks:
  # This is where we keep “nuances” that are common pain points:
  # - some feeds have wrong dates, some need canonicalization, etc.
  date_parsing:
    prefer_updated_if_published_missing: true
  url_normalization:
    strip_tracking_params: true
    tracking_params:
      - utm_source
      - utm_medium
      - utm_campaign
      - utm_term
      - utm_content
